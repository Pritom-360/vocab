<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Builder Pro</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        body { background-color: #f0f2f5; }
        .container { max-width: 960px; }
        .card { border: none; border-radius: 0.75rem; }
        .card-header-custom { background-color: #0d6efd; color: white; border-top-left-radius: 0.75rem; border-top-right-radius: 0.75rem; }
        #result-card { display: none; }
        .notification-container { position: fixed; top: 1rem; right: 1rem; z-index: 1050; }
        .phonetic-text { color: #6c757d; }
        .audio-icon { cursor: pointer; color: #0d6efd; transition: color 0.2s; }
        .audio-icon:hover { color: #0a58ca; }
        .part-of-speech { font-style: italic; font-weight: bold; margin-top: 1.25rem; border-bottom: 1px solid #dee2e6; padding-bottom: 0.5rem; }
        .footer { padding: 2rem 0; margin-top: 3rem; font-size: 0.9rem; text-align: center; color: #6c757d; }
        .badge-group .badge { margin-right: 5px; margin-bottom: 5px; }
        .section-divider { margin: 3rem 0; border: 0; border-top: 1px solid rgba(0,0,0,0.1); }
        .saved-word-item { border-left: 4px solid #0d6efd; margin-bottom: 10px; border-radius: 0.25rem !important; }
        .delete-word-btn { cursor: pointer; color: #dc3545; font-size: 1.2rem; }
        .delete-word-btn:hover { color: #a71d2a; }
        .text-muted-small { font-size: 0.85em; color: #6c757d; }
    </style>
</head>
<body>

    <div class="container my-5">
        <header class="text-center mb-5">
            <h1 class="display-5">Vocabulary Builder Pro</h1>
            <p class="lead text-muted">Find, define, and manage your personal dictionary.</p>
        </header>

        <!-- Section 1: Word Finder -->
        <section id="word-finder">
            <h2 class="mb-3"><i class="bi bi-search text-primary"></i> Word Finder</h2>
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <form id="search-form">
                        <div class="input-group">
                            <input type="text" id="word-input" class="form-control form-control-lg" placeholder="Enter a word..." required>
                            <button class="btn btn-primary btn-lg" type="submit" id="search-button">Search</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="loader" class="text-center my-4 d-none">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"><span class="visually-hidden">Loading...</span></div>
            </div>

            <div class="card mt-4 shadow-sm" id="result-card">
                 <div class="card-header card-header-custom"><h3 class="mb-0" id="word-title"></h3></div>
                <div class="card-body" id="result-body"></div>
                <div class="card-footer text-end bg-white">
                     <button class="btn btn-success" id="save-button"><i class="bi bi-cloud-arrow-up-fill"></i> Save to Vocabulary</button>
                </div>
            </div>
        </section>

        <hr class="section-divider">

        <!-- Section 2: Saved Vocabulary -->
        <section id="saved-words">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0"><i class="bi bi-card-checklist text-success"></i> My Vocabulary List</h2>
                <button class="btn btn-sm btn-outline-secondary" id="refresh-list-button">
                    <span id="refresh-icon-container"><i class="bi bi-arrow-clockwise"></i></span> Refresh
                </button>
            </div>
            <div id="saved-words-loader" class="text-center my-4 d-none">
                 <div class="spinner-border text-success" role="status"><span class="visually-hidden">Loading...</span></div>
            </div>
            <div class="card shadow-sm">
                <ul class="list-group list-group-flush" id="saved-words-list">
                    <p id="no-words-message" class="text-center text-muted p-4">Your saved words will appear here.</p>
                </ul>
            </div>
        </section>
        
        <footer class="footer">
            Powered by <a href="https://dictionaryapi.dev/" target="_blank" rel="noopener noreferrer">DictionaryAPI.dev</a> and Google Sheets.
        </footer>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>
    
    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxqkeoNv68Ha_mVOndDaGz607j-1h_YK9Oh5UsQ_bOLvGDqJfrGRgQamya2VL-wWOZV-Q/exec'; 

        const searchForm = document.getElementById('search-form');
        const wordInput = document.getElementById('word-input');
        const resultCard = document.getElementById('result-card');
        const resultBody = document.getElementById('result-body');
        const wordTitle = document.getElementById('word-title');
        const saveButton = document.getElementById('save-button');
        const loader = document.getElementById('loader');
        const notificationContainer = document.getElementById('notification-container');
        const savedWordsList = document.getElementById('saved-words-list');
        const savedWordsLoader = document.getElementById('saved-words-loader');
        const noWordsMessage = document.getElementById('no-words-message');
        const refreshListButton = document.getElementById('refresh-list-button');
        const refreshIconContainer = document.getElementById('refresh-icon-container');
        
        let currentWordData = {};

        function showNotification(message, type = 'success') {
            const alertEl = document.createElement('div');
            alertEl.className = `alert alert-${type} alert-dismissible fade show`;
            alertEl.role = 'alert';
            alertEl.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
            notificationContainer.appendChild(alertEl);
            setTimeout(() => bootstrap.Alert.getOrCreateInstance(alertEl)?.close(), 5000);
        }

        async function fetchAndDisplayWord(word) {
            resultCard.style.display = 'none';
            loader.classList.remove('d-none');
            
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.title || 'Word not found.');
                }
                const data = await response.json();
                displayResults(data[0]);
                currentWordData = data[0];
            } catch (error) {
                showNotification(error.message, 'danger');
            } finally {
                loader.classList.add('d-none');
            }
        }

        function displayResults(wordData) {
            wordTitle.textContent = wordData.word;
            resultBody.innerHTML = '';

            const phonetic = wordData.phonetics.find(p => p.text && p.audio) || wordData.phonetics.find(p => p.text);
            if (phonetic) {
                const phoneticEl = document.createElement('div');
                phoneticEl.className = 'd-flex align-items-center mb-3';
                phoneticEl.innerHTML = `<span class="phonetic-text fs-5 me-3">${phonetic.text || ''}</span>`;
                if (phonetic.audio) {
                    const audioEl = document.createElement('i');
                    audioEl.className = 'bi bi-volume-up-fill audio-icon fs-4';
                    audioEl.onclick = () => new Audio(phonetic.audio).play();
                    phoneticEl.appendChild(audioEl);
                }
                resultBody.appendChild(phoneticEl);
            }

            wordData.meanings.forEach(meaning => {
                resultBody.innerHTML += `<p class="part-of-speech">${meaning.partOfSpeech}</p>`;
                meaning.definitions.slice(0, 3).forEach((def, i) => {
                    resultBody.innerHTML += `
                        <div class="mb-3">
                            <p class="mb-1"><strong>${i + 1}.</strong> ${def.definition}</p>
                            <p class="text-muted fst-italic ps-3 mb-1">${def.example ? `e.g., "${def.example}"` : '<span class="text-muted-small">No example sentence found.</span>'}</p>
                        </div>`;
                });

                resultBody.innerHTML += `<h6>Synonyms</h6><p class="badge-group">${meaning.synonyms?.length ? meaning.synonyms.map(s => `<span class="badge bg-secondary">${s}</span>`).join(' ') : '<span class="text-muted-small">No synonyms found.</span>'}</p>`;
                resultBody.innerHTML += `<h6>Antonyms</h6><p class="badge-group">${meaning.antonyms?.length ? meaning.antonyms.map(a => `<span class="badge bg-dark">${a}</span>`).join(' ') : '<span class="text-muted-small">No antonyms found.</span>'}</p>`;
            });

            resultCard.style.display = 'block';
        }
        
        async function saveToGoogleSheet() {
            if (GOOGLE_APPS_SCRIPT_URL === 'https://script.google.com/macros/s/AKfycbxqkeoNv68Ha_mVOndDaGz607j-1h_YK9Oh5UsQ_bOLvGDqJfrGRgQamya2VL-wWOZV-Q/exec') {
                return showNotification('Please configure the Google Apps Script URL in the script.', 'danger');
            }
            if (!currentWordData.word) return showNotification('No word to save.', 'danger');
            
            const primaryDefinition = currentWordData.meanings[0]?.definitions[0]?.definition || 'No definition found.';
            const dataToSend = { action: 'save', word: currentWordData.word, definition: primaryDefinition };

            saveButton.disabled = true;
            saveButton.innerHTML = `<span class="spinner-border spinner-border-sm"></span> Saving...`;

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST', mode: 'cors', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify(dataToSend)
                });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification(result.message, 'success');
                    wordInput.value = '';
                    await fetchSavedWords();
                } else {
                    throw new Error(result.message || 'An unknown error occurred.');
                }
            } catch (error) {
                 showNotification(`Error saving: ${error.message}`, 'danger');
            } finally {
                saveButton.disabled = false;
                saveButton.innerHTML = `<i class="bi bi-cloud-arrow-up-fill"></i> Save to Vocabulary`;
            }
        }

        async function deleteWord(word, elementToRemove) {
            const dataToSend = { action: 'delete', word: word };

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST', mode: 'cors', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify(dataToSend)
                });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification(result.message, 'success');
                    elementToRemove.remove();
                     if (savedWordsList.children.length === 1) { // Only the 'no words' p-tag remains
                        noWordsMessage.style.display = 'block';
                    }
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                showNotification(`Error deleting word: ${error.message}`, 'danger');
            }
        }
        
        async function fetchSavedWords() {
            if (GOOGLE_APPS_SCRIPT_URL === 'https://script.google.com/macros/s/AKfycbxqkeoNv68Ha_mVOndDaGz607j-1h_YK9Oh5UsQ_bOLvGDqJfrGRgQamya2VL-wWOZV-Q/exec') {
                noWordsMessage.textContent = "Please configure the Google Apps Script URL to see your saved words.";
                return;
            }
            savedWordsLoader.classList.remove('d-none');
            refreshListButton.disabled = true;
            refreshIconContainer.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>`;
            savedWordsList.innerHTML = '';
            noWordsMessage.style.display = 'none';

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL);
                const result = await response.json();

                if (result.status === 'success' && result.data?.length > 0) {
                    result.data.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item saved-word-item';
                        li.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">
                                <div>
                                    <h5 class="mb-1">${item.word}</h5>
                                    <p class="mb-1">${item.definition}</p>
                                </div>
                                <div>
                                    <i class="bi bi-trash-fill delete-word-btn" data-word="${item.word}" title="Delete word"></i>
                                </div>
                            </div>
                            <small class="text-muted">Saved on: ${item.date}</small>
                        `;
                        savedWordsList.appendChild(li);
                    });
                } else {
                    noWordsMessage.textContent = "No words saved yet. Use the Word Finder to add some!";
                    noWordsMessage.style.display = 'block';
                }
            } catch (error) {
                showNotification('Could not fetch vocabulary list. ' + error.message, 'danger');
                noWordsMessage.textContent = "An error occurred while fetching your words.";
                noWordsMessage.style.display = 'block';
            } finally {
                savedWordsLoader.classList.add('d-none');
                refreshListButton.disabled = false;
                refreshIconContainer.innerHTML = `<i class="bi bi-arrow-clockwise"></i>`;
                if (!savedWordsList.hasChildNodes()) {
                    savedWordsList.appendChild(noWordsMessage);
                }
            }
        }

        // --- EVENT LISTENERS ---
        searchForm.addEventListener('submit', e => {
            e.preventDefault();
            const searchTerm = wordInput.value.trim();
            if (searchTerm) fetchAndDisplayWord(searchTerm);
            else showNotification('Please enter a word.', 'danger');
        });
        
        saveButton.addEventListener('click', saveToGoogleSheet);
        refreshListButton.addEventListener('click', fetchSavedWords);

        savedWordsList.addEventListener('click', e => {
            if (e.target.classList.contains('delete-word-btn')) {
                const word = e.target.dataset.word;
                const listItem = e.target.closest('.list-group-item');
                if (confirm(`Are you sure you want to delete the word "${word}"?`)) {
                    deleteWord(word, listItem);
                }
            }
        });

        document.addEventListener('DOMContentLoaded', fetchSavedWords);

        // --- Bootstrap JS ---
        const bootstrapScript = document.createElement('script');
        bootstrapScript.src = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js";
        bootstrapScript.integrity = "sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz";
        bootstrapScript.crossOrigin = "anonymous";
        document.body.appendChild(bootstrapScript);
    </script>
</body>
</html>
